<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fabricacion de stock</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Sora:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./assets/css/styles-fabricacion.css" />
  </head>
  <body>
    <main class="app-shell">
      <div class="container py-4 py-md-5">
        <div class="row justify-content-center">
          <div class="col-12 col-lg-10 col-xl-9">
            <header class="mb-4">
              <div class="d-flex align-items-start justify-content-between gap-3 flex-wrap">
                <div>
                  <span class="badge badge-signal" data-i18n="badge">IaaS / PaaS</span>
                  <h1 class="display-6 fw-semibold mb-2" data-i18n="title">Fabricacion de stock</h1>
                  <p class="text-secondary mb-0" data-i18n="subtitle">
                    Wizard para transformar insumos en productos con trazabilidad y autosave.
                  </p>
                </div>
                <div class="d-flex align-items-center gap-2">
                  <button id="btnReset" type="button" class="btn btn-outline-light btn-sm" data-i18n="reset">
                    Reiniciar
                  </button>
                  <button id="btnShowSql" type="button" class="btn btn-outline-light btn-sm" data-i18n="sqlLogs">
                    Logs SQL
                  </button>
                </div>
              </div>
            </header>

            <section class="card glass-card shadow-lg">
              <div class="card-body p-3 p-md-4">
                <div class="mb-3">
                  <div class="d-flex align-items-center justify-content-between mb-2">
                    <div class="small text-secondary" id="stepLabel"></div>
                    <div class="small text-secondary">
                      <span id="stepCounter"></span>
                    </div>
                  </div>
                  <div class="progress" role="progressbar" aria-label="Progress" aria-valuemin="0" aria-valuemax="100">
                    <div id="progressBar" class="progress-bar"></div>
                  </div>
                </div>

                <div id="alertContainer"></div>

                <form id="wizardForm" novalidate>
                  <section class="wizard-step" data-step="1">
                    <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap mb-2">
                      <h2 class="h5 mb-0" data-i18n="step1Title">Paso 1 - Crear fabricacion</h2>
                      <span class="badge text-bg-light border" data-i18n="autosave">Auto-guardado</span>
                    </div>

                    <div class="row g-3 mb-3">
                      <div class="col-12 col-md-4">
                        <label class="form-label" for="vFecha" data-i18n="fabricationDate">Fecha</label>
                        <input id="vFecha" name="vFecha" type="date" class="form-control" required />
                        <div class="invalid-feedback" data-i18n="requiredField">Campo requerido.</div>
                      </div>
                      <div class="col-12 col-md-4">
                        <label class="form-label" for="vTipo_documento" data-i18n="docType">Tipo documento</label>
                        <input
                          id="vTipo_documento"
                          name="vTipo_documento"
                          type="text"
                          class="form-control"
                          value="FAB"
                          disabled
                        />
                      </div>
                      <div class="col-12 col-md-4">
                        <label class="form-label" for="vNum_documento" data-i18n="docNumber"># Documento</label>
                        <input id="vNum_documento" name="vNum_documento" type="text" class="form-control" disabled />
                      </div>
                    </div>

                    <div class="row g-3">
                      <div class="col-12 col-md-6">
                        <label class="form-label" for="vCodigo_base" data-i18n="base">Base</label>
                        <select id="vCodigo_base" name="vCodigo_base" class="form-select" required></select>
                        <div class="invalid-feedback" data-i18n="requiredField">Campo requerido.</div>
                      </div>
                    </div>

                    <div class="row g-3 mt-1">
                      <div class="col-12">
                        <label class="form-label" data-i18n="consumoTitle">Detalle consumo</label>
                        <p class="text-secondary small mb-0" data-i18n="consumoHint">
                          Registra los insumos consumidos (se guardan en negativo).
                        </p>
                      </div>
                    </div>

                    <div class="mt-3">
                      <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap mb-2">
                        <div class="small text-secondary" data-i18n="gridBadge">Grid editable</div>
                        <button id="btnAddConsumo" type="button" class="btn btn-primary btn-sm" data-i18n="addConsumo">
                          Agregar consumo
                        </button>
                      </div>
                      <div class="table-responsive">
                        <table class="table table-sm align-middle" id="tblDetalleConsumo">
                          <thead>
                            <tr>
                              <th style="min-width: 240px" data-i18n="productCode">Codigo producto</th>
                              <th style="min-width: 140px" data-i18n="quantity">Cantidad</th>
                              <th class="text-end" style="width: 1%"></th>
                            </tr>
                          </thead>
                          <tbody></tbody>
                        </table>
                      </div>
                    </div>

                    <div class="row g-3 mt-4">
                      <div class="col-12">
                        <label class="form-label" data-i18n="fabricadoTitle">Detalle fabricado</label>
                        <p class="text-secondary small mb-0" data-i18n="fabricadoHint">
                          Registra los productos fabricados (se guardan en positivo).
                        </p>
                      </div>
                    </div>

                    <div class="mt-3">
                      <div class="d-flex align-items-center justify-content-between gap-3 flex-wrap mb-2">
                        <div class="small text-secondary" data-i18n="gridBadge">Grid editable</div>
                        <button
                          id="btnAddFabricado"
                          type="button"
                          class="btn btn-outline-primary btn-sm"
                          data-i18n="addFabricado"
                        >
                          Agregar fabricado
                        </button>
                      </div>
                      <div class="table-responsive">
                        <table class="table table-sm align-middle" id="tblDetalleFabricado">
                          <thead>
                            <tr>
                              <th style="min-width: 240px" data-i18n="productCode">Codigo producto</th>
                              <th style="min-width: 140px" data-i18n="quantity">Cantidad</th>
                              <th class="text-end" style="width: 1%"></th>
                            </tr>
                          </thead>
                          <tbody></tbody>
                        </table>
                      </div>
                    </div>
                  </section>

                  <section class="wizard-step d-none" data-step="2">
                    <div class="d-flex align-items-start justify-content-between gap-3 flex-wrap mb-3">
                      <div>
                        <h2 class="h5 mb-1" data-i18n="step2Title">Paso 2 - Confirmar fabricacion</h2>
                        <p class="text-secondary small mb-0" data-i18n="reviewHint">
                          Revisa el resumen y crea la fabricacion de movimiento.
                        </p>
                      </div>
                      <button id="btnCrearFabricacion" type="button" class="btn btn-success" data-i18n="createFab">
                        Crear fabricacion
                      </button>
                    </div>

                    <div class="row g-3">
                      <div class="col-12 col-lg-7">
                        <div class="summary-card" id="summary"></div>
                      </div>
                      <div class="col-12 col-lg-5">
                        <div class="status-card">
                          <h3 class="h6 mb-2" data-i18n="status">Estado</h3>
                          <div id="statusPanel" class="p-3 rounded border bg-body">
                            <div class="text-secondary small" id="statusText" data-i18n="idle">Listo.</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </section>
                </form>

                <div class="d-flex align-items-center justify-content-between gap-2 mt-4">
                  <button id="btnPrev" type="button" class="btn btn-outline-secondary" data-i18n="prev">
                    Anterior
                  </button>
                  <button id="btnNext" type="button" class="btn btn-primary" data-i18n="next">
                    Siguiente
                  </button>
                </div>
              </div>
            </section>

            <footer class="text-secondary small mt-3">
              <span data-i18n="footer">Bootstrap 5.3 - HTML5 - JavaScript ES6+</span>
            </footer>
          </div>
        </div>
      </div>
    </main>

    <div class="modal fade" id="confirmModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" data-i18n="confirmTitle">Confirmar</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="confirmBody" data-i18n="confirmBody">
            Confirmas la operacion?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" data-i18n="cancel">
              Cancelar
            </button>
            <button type="button" class="btn btn-primary" id="btnConfirmOk" data-i18n="confirm">
              Confirmar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="sqlModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" data-i18n="sqlLogs">Logs SQL</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="sqlLogsPanel"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" data-i18n="close">
              Cerrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script type="module" src="./assets/js/appFabricacion.js"></script>
  </body>
</html>
