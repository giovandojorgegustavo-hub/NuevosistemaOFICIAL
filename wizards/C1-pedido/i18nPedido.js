export function detectLocale() {
  const lang = (navigator.language || "es").toLowerCase();
  return lang.startsWith("es") ? "es" : "en";
}

const DICT = {
  es: {
    title: "Registro multipaso",
    subtitle: "Wizard ERP para IaaS/PaaS global: pedido → factura → entrega → emisión, con UX y guardado automático.",
    reset: "Reiniciar",
    sqlLogs: "Logs SQL",
    step1Title: "Paso 1 · Crear Pedido",
    step2Title: "Paso 2 · Crear Factura",
    step3Title: "Paso 3 · Datos Entrega",
    step4Title: "Paso 4 · Emitir Factura",
    autosave: "Auto-guardado",
    editableGrid: "Grid editable",
    products: "Productos",
    productsHint: "Agrega productos y cantidades. El monto se calcula automáticamente.",
    addRow: "Agregar fila",
    colId: "IdProducto",
    colDesc: "Descripción",
    colQty: "Cantidad",
    colPrice: "Precio",
    colAmount: "Monto",
    colBalance: "Saldo",
    orderDate: "Fecha",
    orderTime: "Hora",
    client: "Cliente",
    whatsapp: "WhatsApp",
    dni: "DNI",
    fullName: "Nombre completo",
    province: "Provincia",
    locality: "Localidad",
    district: "Distrito",
    address: "Dirección",
    base: "Base",
    packing: "Packing",
    issueDate: "Fecha emisión",
    deliveryHint: "Selecciona receptor y punto de entrega, o crea uno nuevo.",
    deliveryPoint: "Punto entrega",
    addDeliveryPoint: "Agregar nuevo punto",
    deliveryRegion: "Región entrega",
    ubigeoDep: "Cod dep",
    ubigeoProv: "Cod prov",
    ubigeoDist: "Cod dist",
    findUbigeo: "Buscar ubigeo",
    deliveryLine: "Direccion linea",
    reference: "Referencia",
    recipientName: "Destinatario",
    recipientDni: "DNI",
    agency: "Agencia",
    deliveryReceiver: "Receptor",
    reviewHint: "Revisa el resumen, confirma y emite la factura.",
    invoiceHint: "La factura se inicializa con los productos del pedido, pero puedes editar o agregar nuevas líneas.",
    emitInvoice: "Emitir factura",
    status: "Estado",
    idle: "Listo.",
    prev: "Anterior",
    next: "Siguiente",
    footer: "Bootstrap 5.3 · HTML5 · JavaScript ES6+",
    confirmTitle: "Confirmar",
    confirmBody: "¿Confirmas la operación?",
    cancel: "Cancelar",
    confirm: "Confirmar",
    close: "Cerrar",
    requiredField: "Campo requerido.",
    invalidPhone: "Número inválido.",
    invalidDni: "DNI inválido.",
    invalidName: "Nombre inválido.",
    loading: "Cargando…",
    error: "Error",
    dbConnecting: "Conectando a la base de datos…",
    dbConnected: "Conexión OK",
    dbFailed: "No se pudo conectar a la base de datos",
    restored: "Se restauró un borrador guardado.",
    noDraft: "No hay borrador guardado.",
    draftCleared: "Borrador eliminado.",
    validationError: "Revisa los campos marcados.",
    emitOk: "Factura emitida. Se generó un archivo descargable.",
    selectProduct: "Selecciona…",
    labelClient: "Cliente",
    labelDateTime: "Fecha/Hora",
    labelRecipient: "Destinatario",
    labelWhatsApp: "WhatsApp",
    labelDni: "DNI",
    labelBase: "Base",
    labelIssueDate: "Fecha emisión",
    labelDeliveryPoint: "Punto entrega",
    labelDeliveryRegion: "Región entrega",
    labelDeliveryLine: "Direccion linea",
    labelReference: "Referencia",
    labelAgency: "Agencia",
    labelDeliveryReceiver: "Receptor",
    labelTotal: "Total",
    labelQtyShort: "Cant.",
    newDeliveryPoint: "Nuevo punto",
    ubigeoInvalid: "Ubigeo invalido.",
    ubigeoNotFound: "Ubigeo no encontrado.",
  },
  en: {
    title: "Multi-step registration",
    subtitle: "ERP wizard for a global IaaS/PaaS provider: order → invoice → delivery → issuance, with UX and autosave.",
    reset: "Reset",
    sqlLogs: "SQL logs",
    step1Title: "Step 1 · Create Order",
    step2Title: "Step 2 · Create Invoice",
    step3Title: "Step 3 · Delivery Details",
    step4Title: "Step 4 · Issue Invoice",
    autosave: "Auto-save",
    editableGrid: "Editable grid",
    products: "Products",
    productsHint: "Add products and quantities. Amount is calculated automatically.",
    addRow: "Add row",
    colId: "ProductId",
    colDesc: "Description",
    colQty: "Quantity",
    colPrice: "Price",
    colAmount: "Amount",
    colBalance: "Balance",
    orderDate: "Date",
    orderTime: "Time",
    client: "Client",
    whatsapp: "WhatsApp",
    dni: "ID number",
    fullName: "Full name",
    province: "Province",
    locality: "Locality",
    district: "District",
    address: "Address",
    base: "Base",
    packing: "Packing",
    issueDate: "Issue date",
    deliveryHint: "Pick a receiver and delivery point, or create a new one.",
    deliveryPoint: "Delivery point",
    addDeliveryPoint: "Add new point",
    deliveryRegion: "Delivery region",
    ubigeoDep: "Dept code",
    ubigeoProv: "Prov code",
    ubigeoDist: "Dist code",
    findUbigeo: "Find ubigeo",
    deliveryLine: "Address line",
    reference: "Reference",
    recipientName: "Recipient",
    recipientDni: "ID",
    agency: "Agency",
    deliveryReceiver: "Receiver",
    reviewHint: "Review the summary, confirm, and issue the invoice.",
    invoiceHint: "The invoice starts from the order products, but you can edit or add new lines.",
    emitInvoice: "Issue invoice",
    status: "Status",
    idle: "Ready.",
    prev: "Previous",
    next: "Next",
    footer: "Bootstrap 5.3 · HTML5 · JavaScript ES6+",
    confirmTitle: "Confirm",
    confirmBody: "Do you want to confirm this operation?",
    cancel: "Cancel",
    confirm: "Confirm",
    close: "Close",
    requiredField: "Required field.",
    invalidPhone: "Invalid number.",
    invalidDni: "Invalid ID.",
    invalidName: "Invalid name.",
    loading: "Loading…",
    error: "Error",
    dbConnecting: "Connecting to database…",
    dbConnected: "Connection OK",
    dbFailed: "Could not connect to the database",
    restored: "A saved draft was restored.",
    noDraft: "No saved draft.",
    draftCleared: "Draft cleared.",
    validationError: "Please review the highlighted fields.",
    emitOk: "Invoice issued. A downloadable file was generated.",
    selectProduct: "Select…",
    labelClient: "Client",
    labelDateTime: "Date/Time",
    labelRecipient: "Recipient",
    labelWhatsApp: "WhatsApp",
    labelDni: "ID",
    labelBase: "Base",
    labelIssueDate: "Issue date",
    labelDeliveryPoint: "Delivery point",
    labelDeliveryRegion: "Delivery region",
    labelDeliveryLine: "Address line",
    labelReference: "Reference",
    labelAgency: "Agency",
    labelDeliveryReceiver: "Receiver",
    labelTotal: "Total",
    labelQtyShort: "Qty",
    newDeliveryPoint: "New point",
    ubigeoInvalid: "Invalid ubigeo.",
    ubigeoNotFound: "Ubigeo not found.",
  },
};

export function t(locale, key) {
  return DICT[locale]?.[key] ?? DICT.es[key] ?? key;
}

export function applyI18n(locale) {
  document.documentElement.lang = locale;
  for (const el of document.querySelectorAll("[data-i18n]")) {
    const key = el.getAttribute("data-i18n");
    el.textContent = t(locale, key);
  }
}
