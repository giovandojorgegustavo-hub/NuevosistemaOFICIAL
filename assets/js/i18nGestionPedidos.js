export function detectLocale() {
  const lang = (navigator.language || "es").toLowerCase();
  return lang.startsWith("es") ? "es" : "en";
}

const DICT = {
  es: {
    title: "Gestion de pedidos",
    subtitle: "Wizard ERP para IaaS/PaaS global: pedidos pendientes, facturacion y entrega con UX y guardado automatico.",
    reset: "Reiniciar",
    sqlLogs: "Logs SQL",
    step1Title: "Paso 1 - Seleccionar Pedido",
    step2Title: "Paso 2 - Crear Factura",
    step3Title: "Paso 3 - Datos Entrega",
    autosave: "Auto-guardado",
    editableGrid: "Grid editable",
    selectOrderHint: "Filtra pedidos pendientes por cliente y fecha. Selecciona el pedido que deseas facturar.",
    filterClient: "Cliente",
    filterDate: "Fecha",
    applyFilters: "Aplicar filtros",
    colOrderDate: "Fecha",
    colOrderCode: "Codigo pedido",
    colClientCode: "Codigo cliente",
    colClientName: "Nombre cliente",
    selectOrder: "Seleccionar",
    noOrders: "Sin pedidos pendientes.",
    issueDate: "Fecha emision",
    base: "Base",
    addRow: "Agregar fila",
    colId: "IdProducto",
    colDesc: "Descripcion",
    colQty: "Cantidad",
    colPrice: "Precio",
    colAmount: "Monto",
    invoiceHint: "La factura se inicializa con los productos del pedido, pero puedes editar o agregar nuevas lineas.",
    deliveryHint: "Selecciona direccion, receptor y lugar de envio desde la base de datos.",
    deliveryAddress: "Direccion",
    deliveryReceiver: "Receptor",
    deliveryShipTo: "Lugar envio",
    documentType: "Tipo documento",
    emitInvoice: "Emitir factura",
    status: "Estado",
    idle: "Listo.",
    prev: "Anterior",
    next: "Siguiente",
    footer: "Bootstrap 5.3 - HTML5 - JavaScript ES6+",
    confirmTitle: "Confirmar",
    confirmBody: "Confirmas la operacion?",
    cancel: "Cancelar",
    confirm: "Confirmar",
    close: "Cerrar",
    requiredField: "Campo requerido.",
    loading: "Cargando...",
    error: "Error",
    dbConnecting: "Conectando a la base de datos...",
    dbConnected: "Conexion OK",
    dbFailed: "No se pudo conectar a la base de datos",
    restored: "Se restauro un borrador guardado.",
    noDraft: "No hay borrador guardado.",
    draftCleared: "Borrador eliminado.",
    validationError: "Revisa los campos marcados.",
    emitOk: "Factura emitida. Se genero un archivo descargable.",
    selectProduct: "Selecciona...",
    filterAll: "Todos",
    labelOrder: "Pedido",
    labelClient: "Cliente",
    labelIssueDate: "Fecha emision",
    labelBase: "Base",
    labelDeliveryAddress: "Direccion",
    labelDeliveryReceiver: "Receptor",
    labelDeliveryShipTo: "Lugar envio",
    labelTotal: "Total",
    labelQtyShort: "Cant.",
  },
  en: {
    title: "Order management",
    subtitle: "ERP wizard for a global IaaS/PaaS provider: pending orders, invoicing, and delivery with UX and autosave.",
    reset: "Reset",
    sqlLogs: "SQL logs",
    step1Title: "Step 1 - Select Order",
    step2Title: "Step 2 - Create Invoice",
    step3Title: "Step 3 - Delivery Details",
    autosave: "Auto-save",
    editableGrid: "Editable grid",
    selectOrderHint: "Filter pending orders by client and date. Select the order to invoice.",
    filterClient: "Client",
    filterDate: "Date",
    applyFilters: "Apply filters",
    colOrderDate: "Date",
    colOrderCode: "Order code",
    colClientCode: "Client code",
    colClientName: "Client name",
    selectOrder: "Select",
    noOrders: "No pending orders.",
    issueDate: "Issue date",
    base: "Base",
    addRow: "Add row",
    colId: "ProductId",
    colDesc: "Description",
    colQty: "Quantity",
    colPrice: "Price",
    colAmount: "Amount",
    invoiceHint: "The invoice starts from the order products, but you can edit or add new lines.",
    deliveryHint: "Pick address, receiver, and ship-to from the database.",
    deliveryAddress: "Address",
    deliveryReceiver: "Receiver",
    deliveryShipTo: "Ship-to",
    documentType: "Document type",
    emitInvoice: "Issue invoice",
    status: "Status",
    idle: "Ready.",
    prev: "Previous",
    next: "Next",
    footer: "Bootstrap 5.3 - HTML5 - JavaScript ES6+",
    confirmTitle: "Confirm",
    confirmBody: "Do you want to confirm this operation?",
    cancel: "Cancel",
    confirm: "Confirm",
    close: "Close",
    requiredField: "Required field.",
    loading: "Loading...",
    error: "Error",
    dbConnecting: "Connecting to database...",
    dbConnected: "Connection OK",
    dbFailed: "Could not connect to the database",
    restored: "A saved draft was restored.",
    noDraft: "No saved draft.",
    draftCleared: "Draft cleared.",
    validationError: "Please review the highlighted fields.",
    emitOk: "Invoice issued. A downloadable file was generated.",
    selectProduct: "Select...",
    filterAll: "All",
    labelOrder: "Order",
    labelClient: "Client",
    labelIssueDate: "Issue date",
    labelBase: "Base",
    labelDeliveryAddress: "Address",
    labelDeliveryReceiver: "Receiver",
    labelDeliveryShipTo: "Ship-to",
    labelTotal: "Total",
    labelQtyShort: "Qty",
  },
};

export function t(locale, key) {
  return DICT[locale]?.[key] ?? DICT.es[key] ?? key;
}

export function applyI18n(locale) {
  document.documentElement.lang = locale;
  for (const el of document.querySelectorAll("[data-i18n]")) {
    const key = el.getAttribute("data-i18n");
    el.textContent = t(locale, key);
  }
}
