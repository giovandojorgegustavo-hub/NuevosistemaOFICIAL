export function detectLocale() {
  const lang = (navigator.language || "es").toLowerCase();
  return lang.startsWith("es") ? "es" : "en";
}

const DICT = {
  es: {
    title: "Registro de viajes",
    subtitle: "Wizard ERP IaaS/PaaS para viajes globales, con control operativo y autosave.",
    reset: "Reiniciar",
    sqlLogs: "Logs SQL",
    step1Title: "Paso 1 · Crear Viaje",
    step2Title: "Paso 2 · Datos Viaje Detalle",
    step3Title: "Paso 3 · Confirmar operación",
    autosave: "Auto-guardado",
    editableGrid: "Grid editable",
    tripCode: "Codigo viaje",
    tripDate: "Fecha viaje",
    driverName: "Motorizado",
    addRow: "Agregar fila",
    docNumber: "Número documento",
    callCount: "Núm. llamadas",
    yapeCount: "Núm. yape",
    link: "Link",
    notes: "Observación",
    whatsapp: "WhatsApp",
    base: "Base",
    packing: "Packing",
    reviewHint: "Revisa el resumen, registra el viaje y despacha cuando esté listo.",
    invoiceHint: "Registra los documentos y el packing asociado a cada envío.",
    registerTrip: "Registrar viaje",
    dispatchTrip: "Despachar viaje",
    status: "Estado",
    idle: "Listo.",
    prev: "Anterior",
    next: "Siguiente",
    footer: "Bootstrap 5.3 · HTML5 · JavaScript ES6+",
    confirmTitle: "Confirmar",
    confirmBody: "¿Confirmas la operación?",
    cancel: "Cancelar",
    confirm: "Confirmar",
    close: "Cerrar",
    requiredField: "Campo requerido.",
    invalidPhone: "Número inválido.",
    invalidNumber: "Número inválido.",
    invalidLink: "Link inválido.",
    loading: "Cargando…",
    error: "Error",
    dbConnecting: "Conectando a la base de datos…",
    dbConnected: "Conexión OK",
    dbFailed: "No se pudo conectar a la base de datos",
    restored: "Se restauró un borrador guardado.",
    noDraft: "No hay borrador guardado.",
    draftCleared: "Borrador eliminado.",
    validationError: "Revisa los campos marcados.",
    registerOk: "Viaje registrado correctamente.",
    dispatchOk: "Viaje despachado correctamente.",
    selectPacking: "Selecciona…",
    auto: "Auto",
    summaryTrip: "Resumen del viaje",
    summaryBase: "Base",
    summaryDriver: "Motorizado",
    summaryDate: "Fecha",
    summaryDocs: "Documentos",
  },
  en: {
    title: "Trip registration",
    subtitle: "IaaS/PaaS ERP wizard for global trips with operational control and autosave.",
    reset: "Reset",
    sqlLogs: "SQL logs",
    step1Title: "Step 1 · Create Trip",
    step2Title: "Step 2 · Trip Detail Data",
    step3Title: "Step 3 · Confirm operation",
    autosave: "Auto-save",
    editableGrid: "Editable grid",
    tripCode: "Trip code",
    tripDate: "Trip date",
    driverName: "Driver",
    addRow: "Add row",
    docNumber: "Document number",
    callCount: "Call count",
    yapeCount: "Yape count",
    link: "Link",
    notes: "Notes",
    whatsapp: "WhatsApp",
    base: "Base",
    packing: "Packing",
    reviewHint: "Review the summary, register the trip, and dispatch when ready.",
    invoiceHint: "Register document numbers and the packing for each shipment.",
    registerTrip: "Register trip",
    dispatchTrip: "Dispatch trip",
    status: "Status",
    idle: "Ready.",
    prev: "Previous",
    next: "Next",
    footer: "Bootstrap 5.3 · HTML5 · JavaScript ES6+",
    confirmTitle: "Confirm",
    confirmBody: "Do you want to confirm this operation?",
    cancel: "Cancel",
    confirm: "Confirm",
    close: "Close",
    requiredField: "Required field.",
    invalidPhone: "Invalid number.",
    invalidNumber: "Invalid number.",
    invalidLink: "Invalid link.",
    loading: "Loading…",
    error: "Error",
    dbConnecting: "Connecting to database…",
    dbConnected: "Connection OK",
    dbFailed: "Could not connect to the database",
    restored: "A saved draft was restored.",
    noDraft: "No saved draft.",
    draftCleared: "Draft cleared.",
    validationError: "Please review the highlighted fields.",
    registerOk: "Trip registered successfully.",
    dispatchOk: "Trip dispatched successfully.",
    selectPacking: "Select…",
    auto: "Auto",
    summaryTrip: "Trip summary",
    summaryBase: "Base",
    summaryDriver: "Driver",
    summaryDate: "Date",
    summaryDocs: "Documents",
  },
};

export function t(locale, key) {
  return DICT[locale]?.[key] ?? DICT.es[key] ?? key;
}

export function applyI18n(locale) {
  document.documentElement.lang = locale;
  for (const el of document.querySelectorAll("[data-i18n]")) {
    const key = el.getAttribute("data-i18n");
    el.textContent = t(locale, key);
  }
}
