export function detectLocale() {
  const lang = (navigator.language || "es").toLowerCase();
  return lang.startsWith("es") ? "es" : "en";
}

const DICT = {
  es: {
    badge: "IaaS / PaaS",
    title: "Fabricacion de stock",
    subtitle: "Wizard para transformar insumos en productos con trazabilidad y autosave.",
    reset: "Reiniciar",
    sqlLogs: "Logs SQL",
    step1Title: "Paso 1 - Crear fabricacion",
    step2Title: "Paso 2 - Confirmar fabricacion",
    autosave: "Auto-guardado",
    fabricationDate: "Fecha",
    docType: "Tipo documento",
    docNumber: "# Documento",
    base: "Base",
    consumoTitle: "Detalle consumo",
    consumoHint: "Registra los insumos consumidos (se guardan en negativo).",
    fabricadoTitle: "Detalle fabricado",
    fabricadoHint: "Registra los productos fabricados (se guardan en positivo).",
    gridBadge: "Grid editable",
    addConsumo: "Agregar consumo",
    addFabricado: "Agregar fabricado",
    productCode: "Codigo producto",
    quantity: "Cantidad",
    reviewHint: "Revisa el resumen y crea la fabricacion de movimiento.",
    createFab: "Crear fabricacion",
    status: "Estado",
    idle: "Listo.",
    prev: "Anterior",
    next: "Siguiente",
    footer: "Bootstrap 5.3 - HTML5 - JavaScript ES6+",
    confirmTitle: "Confirmar",
    confirmBody: "Confirmas la operacion?",
    cancel: "Cancelar",
    confirm: "Confirmar",
    close: "Cerrar",
    requiredField: "Campo requerido.",
    invalidQty: "Cantidad invalida.",
    loading: "Cargando...",
    error: "Error",
    dbConnecting: "Conectando a la base de datos...",
    dbConnected: "Conexion OK",
    dbFailed: "No se pudo conectar a la base de datos",
    restored: "Se restauro un borrador guardado.",
    noDraft: "No hay borrador guardado.",
    draftCleared: "Borrador eliminado.",
    validationError: "Revisa los campos marcados.",
    fabricationOk: "Fabricacion creada correctamente.",
    selectBase: "Selecciona base...",
    selectProduct: "Selecciona producto...",
    docAuto: "Se asigna al crear",
    noRowsConsumo: "Agrega al menos una linea de consumo.",
    noRowsFabricado: "Agrega al menos una linea de fabricado.",
    summaryTitle: "Resumen fabricacion",
    countConsumoLabel: "Lineas consumo",
    countFabricadoLabel: "Lineas fabricado",
    totalConsumoLabel: "Total consumo",
    totalFabricadoLabel: "Total fabricado",
  },
  en: {
    badge: "IaaS / PaaS",
    title: "Stock fabrication",
    subtitle: "Wizard to transform inputs into products with traceability and autosave.",
    reset: "Reset",
    sqlLogs: "SQL logs",
    step1Title: "Step 1 - Create fabrication",
    step2Title: "Step 2 - Confirm fabrication",
    autosave: "Auto-save",
    fabricationDate: "Date",
    docType: "Document type",
    docNumber: "Document #",
    base: "Base",
    consumoTitle: "Consumption detail",
    consumoHint: "Register consumed inputs (saved as negative quantities).",
    fabricadoTitle: "Fabricated detail",
    fabricadoHint: "Register fabricated products (saved as positive quantities).",
    gridBadge: "Editable grid",
    addConsumo: "Add consumption",
    addFabricado: "Add fabricated",
    productCode: "Product code",
    quantity: "Quantity",
    reviewHint: "Review the summary and create the fabrication movement.",
    createFab: "Create fabrication",
    status: "Status",
    idle: "Ready.",
    prev: "Previous",
    next: "Next",
    footer: "Bootstrap 5.3 - HTML5 - JavaScript ES6+",
    confirmTitle: "Confirm",
    confirmBody: "Do you want to confirm this operation?",
    cancel: "Cancel",
    confirm: "Confirm",
    close: "Close",
    requiredField: "Required field.",
    invalidQty: "Invalid quantity.",
    loading: "Loading...",
    error: "Error",
    dbConnecting: "Connecting to database...",
    dbConnected: "Connection OK",
    dbFailed: "Could not connect to the database",
    restored: "A saved draft was restored.",
    noDraft: "No saved draft.",
    draftCleared: "Draft cleared.",
    validationError: "Please review the highlighted fields.",
    fabricationOk: "Fabrication created successfully.",
    selectBase: "Select base...",
    selectProduct: "Select product...",
    docAuto: "Assigned on create",
    noRowsConsumo: "Add at least one consumption line.",
    noRowsFabricado: "Add at least one fabricated line.",
    summaryTitle: "Fabrication summary",
    countConsumoLabel: "Consumption lines",
    countFabricadoLabel: "Fabricated lines",
    totalConsumoLabel: "Total consumed",
    totalFabricadoLabel: "Total fabricated",
  },
};

export function t(locale, key) {
  return DICT[locale]?.[key] ?? DICT.es[key] ?? key;
}

export function applyI18n(locale) {
  document.documentElement.lang = locale;
  for (const el of document.querySelectorAll("[data-i18n]")) {
    const key = el.getAttribute("data-i18n");
    el.textContent = t(locale, key);
  }
}
