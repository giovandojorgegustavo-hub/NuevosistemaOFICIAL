<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CU2003 - Asignar Viajes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!--
    vBases = Llamada SP: get_bases() (devuelve campo_visible)
    Campos devueltos
    vcodigo_base
    vnombre
    Variables
    vcodigo_base no visible editable
    vBaseNombre visible editable

    vPaquetesEmpacados = Llamada SP: get_paquetes_por_estado(p_estado="empacado") (devuelve campo_visible)
    Campos devueltos
    vcodigo_paquete
    vfecha_actualizado
    vcodigo_cliente
    vnombre_cliente
    vnum_cliente
    vcodigo_puntoentrega
    vcodigo_base
    vordinal_numrecibe
    vconcatenarpuntoentrega
    vregion_entrega
    vlatitud
    vlongitud
    vconcatenarnumrecibe
    Variables
    vcodigo_paquete visible no editable
    vfecha_actualizado visible no editable
    vcodigo_cliente no visible no editable
    vnombre_cliente visible no editable
    vnum_cliente visible no editable
    vcodigo_puntoentrega no visible no editable
    vcodigo_base no visible no editable
    vordinal_numrecibe no visible no editable
    vconcatenarpuntoentrega visible no editable
    vRegion_Entrega no visible no editable
    vLatitud no visible no editable
    vLongitud no visible no editable
    vconcatenarnumrecibe visible no editable
    -->

    <div class="app-shell">
      <header class="app-hero">
        <div class="container">
          <div class="hero-content">
            <div>
              <p class="eyebrow">Modulo 2 Â· CU2003</p>
              <h1>Asignar viajes a paquetes empacados</h1>
              <p class="lead">
                Plataforma global de IaaS + PaaS. Gestiona viajes con trazabilidad, mapas y control total de estado.
              </p>
            </div>
            <div class="hero-card">
              <div class="hero-stat">
                <span class="label">Codigo viaje</span>
                <span class="value" id="vcodigoviaje">...</span>
              </div>
              <div class="hero-stat">
                <span class="label">Fecha</span>
                <span class="value" id="vfecha">...</span>
              </div>
            </div>
          </div>
          <div class="progress-wrapper">
            <div class="progress" role="progressbar" aria-label="Progreso">
              <div class="progress-bar" id="progressBar" style="width: 33%"></div>
            </div>
            <div class="progress-steps">
              <span class="step active">1. Datos del viaje</span>
              <span class="step">2. Paquetes</span>
              <span class="step">3. Confirmar</span>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div id="alertContainer"></div>

        <div class="wizard-card">
          <div class="wizard-step" data-step="1">
            <h2>Datos del viaje</h2>
            <p class="muted">Define la cabecera y la base operativa antes de asignar paquetes.</p>

            <div class="row g-3">
              <div class="col-lg-6">
                <label class="form-label">Base</label>
                <input
                  class="form-control"
                  id="vBaseNombre"
                  list="basesList"
                  placeholder="Escribe para filtrar bases"
                  autocomplete="off"
                  required
                />
                <datalist id="basesList"></datalist>
                <div class="form-text" id="baseHelpText">Selecciona la base operativa registrada.</div>
                <input type="hidden" id="vcodigo_base" />
              </div>

              <div class="col-lg-6">
                <label class="form-label">Nombre motorizado</label>
                <input class="form-control" id="vnombre_motorizado" required />
              </div>
              <div class="col-lg-6">
                <label class="form-label">Link</label>
                <input class="form-control" id="vlink" placeholder="https://..." required />
                <div class="form-text">Acepta http://, https:// o www.</div>
              </div>

              <div class="col-lg-4">
                <label class="form-label">Numero WhatsApp</label>
                <input class="form-control" id="vnumero_wsp" placeholder="Opcional" />
              </div>
              <div class="col-lg-4">
                <label class="form-label">Numero llamadas</label>
                <input class="form-control" id="vnum_llamadas" placeholder="Opcional" />
              </div>
              <div class="col-lg-4">
                <label class="form-label">Numero Yape</label>
                <input class="form-control" id="vnum_yape" placeholder="Opcional" />
              </div>

              <div class="col-12">
                <label class="form-label">Observacion</label>
                <textarea class="form-control" id="vobservacion" rows="3"></textarea>
              </div>
            </div>
          </div>

          <div class="wizard-step d-none" data-step="2">
            <div class="step-header">
              <div>
                <h2>Asignar paquetes empacados</h2>
                <p class="muted">Selecciona multiples paquetes. Haz click para ver direccion y mapa.</p>
              </div>
              <button class="btn btn-outline-light" id="refreshPaquetes">Actualizar</button>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle" id="paquetesTable">
                <thead>
                  <tr>
                    <th></th>
                    <th>Codigo</th>
                    <th>Fecha actualizado</th>
                    <th>Cliente</th>
                    <th>Numero</th>
                    <th>Packing</th>
                    <th>Punto entrega</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-lg-5">
                <div class="info-card">
                  <h3>Detalle del paquete</h3>
                  <div class="info-row">
                    <span class="label">Punto entrega</span>
                    <span id="detallePunto">-</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Recibe</span>
                    <span id="detalleRecibe">-</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Packing</span>
                    <span id="detallePacking">-</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Region</span>
                    <span id="detalleRegion">-</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Latitud</span>
                    <span id="detalleLat">-</span>
                  </div>
                  <div class="info-row">
                    <span class="label">Longitud</span>
                    <span id="detalleLng">-</span>
                  </div>
                </div>
              </div>
              <div class="col-lg-7">
                <div id="mapCard" class="map-card d-none">
                  <div class="map-header">
                    <h3>Mapa (solo lectura)</h3>
                    <span class="badge text-bg-info" id="mapBadge">LIMA</span>
                  </div>
                  <div id="map" class="map"></div>
                </div>
                <div id="mapPlaceholder" class="map-placeholder">
                  <p>El mapa solo se muestra para region LIMA.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="wizard-step d-none" data-step="3">
            <h2>Confirmar y guardar</h2>
            <p class="muted">Revisa el resumen antes de confirmar la transaccion.</p>

            <div class="row g-3">
              <div class="col-lg-5">
                <div class="summary-card">
                  <h3>Resumen viaje</h3>
                  <div class="summary-row"><span>Codigo viaje</span><strong id="sumCodigo">-</strong></div>
                  <div class="summary-row"><span>Base</span><strong id="sumBase">-</strong></div>
                  <div class="summary-row"><span>Motorizado</span><strong id="sumMotorizado">-</strong></div>
                  <div class="summary-row"><span>WhatsApp</span><strong id="sumWsp">-</strong></div>
                  <div class="summary-row"><span>Llamadas</span><strong id="sumLlamadas">-</strong></div>
                  <div class="summary-row"><span>Yape</span><strong id="sumYape">-</strong></div>
                  <div class="summary-row"><span>Link</span><strong id="sumLink">-</strong></div>
                  <div class="summary-row"><span>Fecha</span><strong id="sumFecha">-</strong></div>
                </div>
              </div>
              <div class="col-lg-7">
                <div class="summary-card">
                  <div class="summary-header">
                    <h3>Paquetes seleccionados</h3>
                    <span class="badge" id="sumCount">0</span>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-sm" id="resumenTable">
                      <thead>
                        <tr>
                          <th>Codigo</th>
                          <th>Cliente</th>
                          <th>Packing</th>
                          <th>Punto entrega</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-check mt-3">
              <input class="form-check-input" type="checkbox" id="confirmCheck" />
              <label class="form-check-label" for="confirmCheck">Confirmo que los datos son correctos.</label>
            </div>
          </div>

          <div class="wizard-footer">
            <div class="left">
              <button class="btn btn-outline-light" id="prevBtn">Anterior</button>
            </div>
            <div class="right">
              <button class="btn btn-light" id="nextBtn">Siguiente</button>
              <button class="btn btn-primary d-none" id="saveBtn" disabled>Guardar</button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>
