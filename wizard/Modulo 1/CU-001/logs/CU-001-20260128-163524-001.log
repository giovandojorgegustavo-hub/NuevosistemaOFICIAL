[2026-01-28T21:35:24.639Z] [INFO] Iniciando servidor CU-001 usando DB: erpdb
[2026-01-28T21:35:24.646Z] [INFO] Servidor escuchando en puerto 3000
[2026-01-28T21:35:30.910Z] [INFO] ENDPOINT: GET /
[2026-01-28T21:35:31.064Z] [INFO] ENDPOINT: GET /styles.css
[2026-01-28T21:35:31.065Z] [INFO] ENDPOINT: GET /app.js
[2026-01-28T21:35:31.341Z] [INFO] ENDPOINT: GET /api/init
[2026-01-28T21:35:31.361Z] [SQL] CALL get_clientes() | params: []
[2026-01-28T21:35:31.365Z] [SQL] CALL get_productos() | params: []
[2026-01-28T21:35:31.367Z] [SQL] CALL get_bases() | params: []
[2026-01-28T21:35:31.369Z] [SQL] SELECT COALESCE(MAX(codigo_pedido), 0) + 1 AS next FROM pedidos | params: []
[2026-01-28T21:35:31.370Z] [SQL] SELECT COALESCE(MAX(numero_documento), 0) + 1 AS next FROM mov_contable WHERE tipo_documento = 'FAC' | params: []
[2026-01-28T21:35:31.508Z] [INFO] ENDPOINT: GET /api/ubigeo/departamentos
[2026-01-28T21:35:31.509Z] [SQL] CALL get_ubigeo_departamentos() | params: []
[2026-01-28T21:35:33.552Z] [INFO] ENDPOINT: GET /api/puntos-entrega
[2026-01-28T21:35:33.552Z] [SQL] CALL get_puntos_entrega(?) | params: ["1"]
[2026-01-28T21:35:33.554Z] [INFO] ENDPOINT: GET /api/numrecibe
[2026-01-28T21:35:33.559Z] [SQL] CALL get_numrecibe(?) | params: ["1"]
[2026-01-28T21:35:49.611Z] [INFO] ENDPOINT: POST /api/emitir
[2026-01-28T21:35:49.613Z] [SQL] SELECT COALESCE(MAX(codigo_pedido), 0) + 1 AS next FROM pedidos | params: []
[2026-01-28T21:35:49.613Z] [SQL] INSERT INTO pedidos (codigo_pedido, codigo_cliente, fecha) VALUES (?, ?, ?) | params: ["2","1","2026-01-28 16:35:00"]
[2026-01-28T21:35:49.614Z] [SQL] SELECT COALESCE(MAX(ordinal), 0) + 1 AS next FROM pedido_detalle WHERE codigo_pedido = ? | params: ["2"]
[2026-01-28T21:35:49.615Z] [SQL] INSERT INTO pedido_detalle (codigo_pedido, ordinal, codigo_producto, cantidad, precio_total, saldo, precio_unitario) VALUES (?, ?, ?, ?, ?, ?, ?) | params: ["2","1","1",5,50,5,10]
[2026-01-28T21:35:49.616Z] [SQL] INSERT INTO mov_contable
        (codigo_pedido, fecha_emision, fecha_vencimiento, fecha_valor, codigo_cliente, saldo, tipo_documento, numero_documento, codigo_base, codigo_cliente_numrecibe, ordinal_numrecibe, codigo_cliente_puntoentrega, codigo_puntoentrega)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) | params: ["2","2026-01-28 16:35:00","2026-01-28 16:35:00","2026-01-28 16:35:00","1",50,"FAC","2","2","1",1,"1","2"]
[2026-01-28T21:35:49.617Z] [SQL] SELECT COALESCE(MAX(ordinal), 0) + 1 AS next FROM mov_contable_detalle WHERE tipo_documento = ? AND numero_documento = ? | params: ["FAC","2"]
[2026-01-28T21:35:49.618Z] [SQL] INSERT INTO mov_contable_detalle (tipo_documento, numero_documento, ordinal, codigo_producto, cantidad, saldo, precio_total) VALUES (?, ?, ?, ?, ?, ?, ?) | params: ["FAC","2","1","1",5,5,50]
[2026-01-28T21:35:49.619Z] [SQL] INSERT INTO paquete (codigo_paquete, tipo_documento, estado) VALUES (?, ?, ?) | params: ["2","FAC","pendiente empacar"]
[2026-01-28T21:35:49.619Z] [SQL] SELECT COALESCE(MAX(ordinal), 0) + 1 AS next FROM paquetedetalle WHERE codigo_paquete = ? AND tipo_documento = 'FAC' | params: ["2"]
[2026-01-28T21:35:49.620Z] [SQL] INSERT INTO paquetedetalle (codigo_paquete, tipo_documento, ordinal, estado) VALUES (?, ?, ?, ?) | params: ["2","FAC","1","pendiente empacar"]
[2026-01-28T21:35:49.621Z] [SQL] CALL actualizarsaldosclientes(?, ?, ?) | params: ["1","FAC",50]
[2026-01-28T21:35:49.623Z] [SQL] CALL salidaspedidos(?, ?) | params: ["FAC","2"]
[2026-01-28T21:35:51.247Z] [INFO] ENDPOINT: POST /api/emitir
[2026-01-28T21:35:51.248Z] [SQL] SELECT COALESCE(MAX(codigo_pedido), 0) + 1 AS next FROM pedidos | params: []
[2026-01-28T21:35:51.249Z] [SQL] INSERT INTO pedidos (codigo_pedido, codigo_cliente, fecha) VALUES (?, ?, ?) | params: ["2","1","2026-01-28 16:35:00"]
[2026-01-28T21:35:51.250Z] [ERROR] Error: Duplicate entry '2' for key 'pedidos.PRIMARY'
    at PromisePoolConnection.query (/root/erp/NuevosistemaOFICIAL/node_modules/mysql2/lib/promise/connection.js:29:22)
    at queryDb (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:96:21)
    at handleRequest (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:274:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
