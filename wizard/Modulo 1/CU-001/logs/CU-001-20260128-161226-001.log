[2026-01-28T21:12:26.581Z] [INFO] Iniciando servidor CU-001 usando DB: erpdb
[2026-01-28T21:12:26.589Z] [INFO] Servidor escuchando en puerto 3000
[2026-01-28T21:12:33.064Z] [INFO] ENDPOINT: GET /
[2026-01-28T21:12:33.221Z] [INFO] ENDPOINT: GET /styles.css
[2026-01-28T21:12:33.222Z] [INFO] ENDPOINT: GET /app.js
[2026-01-28T21:12:33.498Z] [INFO] ENDPOINT: GET /api/init
[2026-01-28T21:12:33.517Z] [SQL] CALL get_clientes() | params: []
[2026-01-28T21:12:33.520Z] [ERROR] Error: PROCEDURE erpdb.get_clientes does not exist
    at PromisePoolConnection.query (/root/erp/NuevosistemaOFICIAL/node_modules/mysql2/lib/promise/connection.js:29:22)
    at queryDb (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:96:21)
    at handleRequest (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:151:36)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
[2026-01-28T21:12:33.660Z] [INFO] ENDPOINT: GET /api/ubigeo/departamentos
[2026-01-28T21:12:33.661Z] [SQL] CALL get_ubigeo_departamentos() | params: []
[2026-01-28T21:12:33.662Z] [ERROR] Error: PROCEDURE erpdb.get_ubigeo_departamentos does not exist
    at PromisePoolConnection.query (/root/erp/NuevosistemaOFICIAL/node_modules/mysql2/lib/promise/connection.js:29:22)
    at queryDb (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:96:21)
    at handleRequest (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:208:28)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
[2026-01-28T21:13:50.671Z] [INFO] ENDPOINT: GET /
[2026-01-28T21:13:50.818Z] [INFO] ENDPOINT: GET /styles.css
[2026-01-28T21:13:50.819Z] [INFO] ENDPOINT: GET /app.js
[2026-01-28T21:13:51.093Z] [INFO] ENDPOINT: GET /api/init
[2026-01-28T21:13:51.094Z] [SQL] CALL get_clientes() | params: []
[2026-01-28T21:13:51.098Z] [SQL] CALL get_productos() | params: []
[2026-01-28T21:13:51.100Z] [SQL] CALL get_bases() | params: []
[2026-01-28T21:13:51.101Z] [SQL] SELECT COALESCE(MAX(codigo_pedido), 0) + 1 AS next FROM pedidos | params: []
[2026-01-28T21:13:51.102Z] [SQL] SELECT COALESCE(MAX(numero_documento), 0) + 1 AS next FROM mov_contable WHERE tipo_documento = 'FAC' | params: []
[2026-01-28T21:13:51.240Z] [INFO] ENDPOINT: GET /api/ubigeo/departamentos
[2026-01-28T21:13:51.241Z] [SQL] CALL get_ubigeo_departamentos() | params: []
[2026-01-28T21:14:05.195Z] [INFO] ENDPOINT: GET /api/puntos-entrega
[2026-01-28T21:14:05.195Z] [SQL] CALL get_puntos_entrega(?) | params: ["1"]
[2026-01-28T21:14:05.196Z] [INFO] ENDPOINT: GET /api/numrecibe
[2026-01-28T21:14:05.201Z] [SQL] CALL get_numrecibe(?) | params: ["1"]
[2026-01-28T21:14:21.963Z] [INFO] ENDPOINT: POST /api/emitir
[2026-01-28T21:14:21.964Z] [SQL] SELECT COALESCE(MAX(codigo_pedido), 0) + 1 AS next FROM pedidos | params: []
[2026-01-28T21:14:21.965Z] [SQL] INSERT INTO pedidos (codigo_pedido, codigo_cliente, fecha) VALUES (?, ?, ?) | params: ["1","1","2026-01-28 16:13:00"]
[2026-01-28T21:14:21.966Z] [SQL] SELECT COALESCE(MAX(ordinal), 0) + 1 AS next FROM pedido_detalle WHERE codigo_pedido = ? | params: ["1"]
[2026-01-28T21:14:21.968Z] [SQL] INSERT INTO pedido_detalle (codigo_pedido, ordinal, codigo_producto, cantidad, precio_total, saldo, precio_unitario) VALUES (?, ?, ?, ?, ?, ?, ?) | params: ["1","1","1",28,120,28,4.285714285714286]
[2026-01-28T21:14:21.969Z] [SQL] INSERT INTO pedido_detalle (codigo_pedido, ordinal, codigo_producto, cantidad, precio_total, saldo, precio_unitario) VALUES (?, ?, ?, ?, ?, ?, ?) | params: ["1","11","2",14,150,14,10.714285714285714]
[2026-01-28T21:14:21.970Z] [SQL] INSERT INTO mov_contable
        (codigo_pedido, fecha_emision, fecha_vencimiento, fecha_valor, codigo_cliente, saldo, tipo_documento, numero_documento, codigo_base, codigo_cliente_numrecibe, ordinal_numrecibe, codigo_cliente_puntoentrega, codigo_puntoentrega)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) | params: ["1","2026-01-28 16:13:00","2026-01-28 16:13:00","2026-01-28 16:13:00","1",210,"FAC","1","1","1",1,"1","2"]
[2026-01-28T21:14:21.971Z] [SQL] SELECT COALESCE(MAX(ordinal), 0) + 1 AS next FROM mov_contable_detalle WHERE tipo_documento = ? AND numero_documento = ? | params: ["FAC","1"]
[2026-01-28T21:14:21.972Z] [SQL] INSERT INTO mov_contable_detalle (tipo_documento, numero_documento, ordinal, codigo_producto, cantidad, saldo, precio_total) VALUES (?, ?, ?, ?, ?, ?, ?) | params: ["FAC","1","1","1",14,14,60]
[2026-01-28T21:14:21.973Z] [SQL] INSERT INTO mov_contable_detalle (tipo_documento, numero_documento, ordinal, codigo_producto, cantidad, saldo, precio_total) VALUES (?, ?, ?, ?, ?, ?, ?) | params: ["FAC","1","11","2",14,14,150]
[2026-01-28T21:14:21.974Z] [SQL] INSERT INTO paquete (codigo_paquete, tipo_documento, estado) VALUES (?, ?, ?) | params: ["1","FAC","pendiente empacar"]
[2026-01-28T21:14:21.975Z] [SQL] SELECT COALESCE(MAX(ordinal), 0) + 1 AS next FROM paquetedetalle WHERE codigo_paquete = ? AND tipo_documento = 'FAC' | params: ["1"]
[2026-01-28T21:14:21.977Z] [SQL] INSERT INTO paquetedetalle (codigo_paquete, tipo_documento, ordinal, estado) VALUES (?, ?, ?, ?) | params: ["1","FAC","1","pendiente empacar"]
[2026-01-28T21:14:21.977Z] [SQL] CALL actualizarsaldosclientes(?, ?, ?) | params: ["1","FAC",210]
[2026-01-28T21:14:21.979Z] [SQL] CALL salidaspedidos(?, ?) | params: ["FAC","1"]
[2026-01-28T21:14:23.275Z] [INFO] ENDPOINT: POST /api/emitir
[2026-01-28T21:14:23.276Z] [SQL] SELECT COALESCE(MAX(codigo_pedido), 0) + 1 AS next FROM pedidos | params: []
[2026-01-28T21:14:23.277Z] [SQL] INSERT INTO pedidos (codigo_pedido, codigo_cliente, fecha) VALUES (?, ?, ?) | params: ["1","1","2026-01-28 16:13:00"]
[2026-01-28T21:14:23.279Z] [ERROR] Error: Duplicate entry '1' for key 'pedidos.PRIMARY'
    at PromisePoolConnection.query (/root/erp/NuevosistemaOFICIAL/node_modules/mysql2/lib/promise/connection.js:29:22)
    at queryDb (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:96:21)
    at handleRequest (/root/erp/NuevosistemaOFICIAL/wizard/Modulo 1/CU-001/server.js:274:13)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
