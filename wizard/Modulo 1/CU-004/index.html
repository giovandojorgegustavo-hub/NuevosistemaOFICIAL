<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CU-004 | Gestionar paquetes en camino</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!--
  vPaquetesEnCamino = Llamada SP: get_paquetes_por_estado(p_estado="en camino") (devuelve campo_visible)
  Campos devueltos
  vcodigo_paquete
  vfecha_actualizado
  vcodigo_cliente
  vnombre_cliente
  vnum_cliente
  vcodigo_puntoentrega
  vordinal_numrecibe
  vconcatenarpuntoentrega
  vconcatenarnumrecibe
  Variables
  vcodigo_paquete visible no editable
  vfecha_actualizado visible no editable
  vcodigo_cliente no visible no editable
  vnombre_cliente visible no editable
  vnum_cliente visible no editable
  vcodigo_puntoentrega no visible no editable
  vordinal_numrecibe no visible no editable
  vconcatenarpuntoentrega visible no editable
  vconcatenarnumrecibe visible no editable

  vDetalleDocumento = Llamada SP: get_mov_contable_detalle(p_tipo_documento, p_numero_documento) (devuelve campo_visible)
  Campos devueltos
  vtipo_documento
  vnumero_documento
  vordinal
  vcodigo_producto
  vnombre_producto
  vcantidad
  vsaldo
  vprecio_total
  Variables
  vtipo_documento no visible no editable
  vnumero_documento no visible no editable
  vordinal no visible no editable
  vcodigo_producto no visible no editable
  vnombre_producto visible no editable
  vcantidad visible no editable
  vsaldo no visible no editable
  vprecio_total no visible no editable

  vViajeDocumento = Llamada SP: get_viaje_por_documento(p_numero_documento) (devuelve campo_visible)
  Campos devueltos
  vcodigoviaje
  vnombrebase
  vnombre_motorizado
  vnumero_wsp
  vnum_llamadas
  vnum_yape
  vlink
  vobservacion
  vfecha
  Variables
  vcodigoviaje no visible no editable
  vnombrebase visible no editable
  vnombre_motorizado visible no editable
  vnumero_wsp visible no editable
  vnum_llamadas visible no editable
  vnum_yape visible no editable
  vlink visible no editable
  vobservacion visible no editable
  vfecha visible no editable
  vconcatenarpuntoentrega visible no editable
  vconcatenarnumrecibe visible no editable
  -->

  <div class="page-shell">
    <header class="hero">
      <div>
        <div class="eyebrow" data-i18n="eyebrow">Operaciones Globales IaaS / PaaS</div>
        <h1 data-i18n="title">Gestionar paquetes en camino</h1>
        <p class="subtitle" data-i18n="subtitle">
          Confirma el estado de paquetes en ruta con trazabilidad completa y visibilidad del viaje.
        </p>
      </div>
      <div class="hero-actions">
        <span class="badge-soft" data-i18n="case">CU-004</span>
        <button class="btn btn-outline-light" id="btnRefresh" type="button" data-i18n="refresh">Actualizar</button>
        <button class="btn btn-outline-light" id="btnLogs" type="button" data-i18n="viewLogs">Ver logs SQL</button>
      </div>
    </header>

    <div class="wizard-card">
      <div id="alertArea"></div>
      <div class="progress-wrapper">
        <div class="progress" role="progressbar" aria-label="progress">
          <div class="progress-bar" id="wizardProgress" style="width: 0%"></div>
        </div>
        <div class="step-pills">
          <div class="step-pill active" data-step-pill="1" data-i18n="step1Pill">Paquetes</div>
          <div class="step-pill" data-step-pill="2" data-i18n="step2Pill">Detalle</div>
          <div class="step-pill" data-step-pill="3" data-i18n="step3Pill">Confirmar</div>
        </div>
      </div>

      <section class="wizard-step active" data-step="1">
        <div class="section-title" data-i18n="step1Title">Seleccion de paquete en camino</div>
        <div class="section-subtitle" data-i18n="step1Desc">
          Revisa los paquetes en estado en camino y selecciona uno para gestionar.
        </div>
        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label" data-i18n="searchLabel">Buscar paquete</label>
            <input id="searchInput" class="form-control" type="text" data-i18n-placeholder="searchPlaceholder" />
          </div>
          <div class="col-md-6">
            <label class="form-label" data-i18n="selectedLabel">Seleccion actual</label>
            <div class="input-hint" id="selectedHint" data-i18n="noneSelected">Sin paquete seleccionado</div>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-hover align-middle" id="vPaquetesEnCamino">
            <thead>
              <tr>
                <th data-i18n="thCodigo">Codigo</th>
                <th data-i18n="thFecha">Fecha</th>
                <th data-i18n="thCliente">Cliente</th>
                <th data-i18n="thNumero">Numero cliente</th>
                <th data-i18n="thEntrega">Punto entrega</th>
                <th data-i18n="thRecibe">Recibe</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="paquetesBody"></tbody>
          </table>
        </div>
        <div class="action-row mt-3">
          <div class="input-hint" id="countHint"></div>
          <button class="btn btn-primary" id="step1Next" type="button" data-i18n="next">Siguiente</button>
        </div>
      </section>

      <section class="wizard-step" data-step="2">
        <div class="section-title" data-i18n="step2Title">Detalle completo del paquete</div>
        <div class="section-subtitle" data-i18n="step2Desc">
          Consulta los datos del viaje y el detalle del documento seleccionado.
        </div>
        <div class="info-grid">
          <div>
            <div class="info-label" data-i18n="labelCodigo">Codigo paquete</div>
            <div class="info-value" id="detalleCodigo">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelFecha">Fecha</div>
            <div class="info-value" id="detalleFecha">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelBase">Base</div>
            <div class="info-value" id="detalleBase">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelMotorizado">Motorizado</div>
            <div class="info-value" id="detalleMotorizado">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelWsp">WhatsApp</div>
            <div class="info-value" id="detalleWsp">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelLlamadas">Llamadas</div>
            <div class="info-value" id="detalleLlamadas">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelYape">Yape</div>
            <div class="info-value" id="detalleYape">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelEntrega">Punto entrega</div>
            <div class="info-value" id="detalleEntrega">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelRecibe">Recibe</div>
            <div class="info-value" id="detalleRecibe">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelLink">Link</div>
            <div class="info-value" id="detalleLink">-</div>
          </div>
          <div>
            <div class="info-label" data-i18n="labelObs">Observacion</div>
            <div class="info-value" id="detalleObs">-</div>
          </div>
        </div>

        <div class="section-title" data-i18n="detalleTitle">Detalle mov contable</div>
        <div class="table-responsive">
          <table class="table table-hover align-middle" id="vDetalleDocumento">
            <thead>
              <tr>
                <th data-i18n="thProducto">Producto</th>
                <th data-i18n="thCantidad">Cantidad</th>
              </tr>
            </thead>
            <tbody id="detalleBody"></tbody>
          </table>
        </div>
        <div class="action-row mt-3">
          <button class="btn btn-outline-light" id="step2Back" type="button" data-i18n="back">Anterior</button>
          <button class="btn btn-primary" id="step2Next" type="button" data-i18n="next">Siguiente</button>
        </div>
      </section>

      <section class="wizard-step" data-step="3">
        <div class="section-title" data-i18n="step3Title">Confirmar y guardar</div>
        <div class="section-subtitle" data-i18n="step3Desc">
          Define el nuevo estado y confirma la operacion.
        </div>
        <div class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label" data-i18n="labelEstado">Nuevo estado</label>
            <input id="estadoInput" class="form-control" list="estadoOptions" data-i18n-placeholder="estadoPlaceholder" />
            <datalist id="estadoOptions">
              <option value="robado"></option>
              <option value="devuelto"></option>
              <option value="standby"></option>
              <option value="llegado"></option>
            </datalist>
            <div class="input-hint" data-i18n="estadoHint">Solo estados permitidos.</div>
          </div>
          <div class="col-md-6">
            <label class="form-label" data-i18n="labelOrdinal">Ordinal</label>
            <input id="ordinalInput" class="form-control" type="text" readonly />
          </div>
        </div>

        <div class="summary-grid">
          <div class="summary-card">
            <div class="summary-title" data-i18n="summaryPaquete">Paquete</div>
            <div id="summaryPaquete"></div>
          </div>
          <div class="summary-card">
            <div class="summary-title" data-i18n="summaryViaje">Viaje</div>
            <div id="summaryViaje"></div>
          </div>
          <div class="summary-card">
            <div class="summary-title" data-i18n="summaryEstado">Estado</div>
            <div id="summaryEstado"></div>
          </div>
        </div>

        <div class="form-check mt-3">
          <input class="form-check-input" type="checkbox" value="" id="confirmCheck" />
          <label class="form-check-label" for="confirmCheck" data-i18n="confirmText">
            Confirmo que deseo actualizar el estado del paquete.
          </label>
        </div>

        <div class="action-row mt-3">
          <button class="btn btn-outline-light" id="step3Back" type="button" data-i18n="back">Anterior</button>
          <button class="btn btn-primary" id="confirmBtn" type="button" data-i18n="confirm">Confirmar y guardar</button>
        </div>
      </section>
    </div>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-card">
      <div class="spinner-border text-info" role="status"></div>
      <div id="loadingText">Procesando...</div>
    </div>
  </div>

  <div class="modal fade" id="logsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" data-i18n="logsTitle">Logs SQL</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <pre id="logsContent" class="text-light"></pre>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
